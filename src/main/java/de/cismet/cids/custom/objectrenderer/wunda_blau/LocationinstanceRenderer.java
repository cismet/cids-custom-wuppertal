/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * LocationinstanceRenderer.java
 *
 * Created on 21.08.2009, 12:02:33
 */
package de.cismet.cids.custom.objectrenderer.wunda_blau;

import Sirius.navigator.tools.BrowserLauncher;
import de.cismet.cids.custom.objectrenderer.converter.CollectionToStringConverter;
import de.cismet.cids.custom.objectrenderer.utils.ObjectRendererUIUtils;
import de.cismet.cids.dynamics.CidsBean;
import de.cismet.cids.tools.metaobjectrenderer.CidsBeanRenderer;
import de.cismet.tools.collections.TypeSafeCollections;
import de.cismet.tools.gui.BorderProvider;
import de.cismet.tools.gui.FooterComponentProvider;
import de.cismet.tools.gui.Static2DTools;
import de.cismet.tools.gui.TitleComponentProvider;
import java.awt.Cursor;
import java.net.URL;
import java.util.Collection;
import java.util.List;
import javax.swing.BorderFactory;
import javax.swing.Icon;
import javax.swing.ImageIcon;
import javax.swing.JComponent;
import javax.swing.border.Border;
import org.apache.log4j.Logger;

/**
 *
 * @author srichter
 */
public class LocationinstanceRenderer extends javax.swing.JPanel implements CidsBeanRenderer, TitleComponentProvider, FooterComponentProvider, BorderProvider {

    private final Logger log = Logger.getLogger(this.getClass());

    /** Creates new form LocationinstanceRenderer */
    public LocationinstanceRenderer() {
        initComponents();
        ObjectRendererUIUtils.decorateComponentWithMouseOverCursorChange(lblMail, Cursor.HAND_CURSOR, Cursor.DEFAULT_CURSOR);
        ObjectRendererUIUtils.decorateComponentWithMouseOverCursorChange(lblUrl, Cursor.HAND_CURSOR, Cursor.DEFAULT_CURSOR);
    }
    private CidsBean cidsBean;
    private String title;

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;
        bindingGroup = new org.jdesktop.beansbinding.BindingGroup();

        panTitle = new javax.swing.JPanel();
        lblTitle = new javax.swing.JLabel();
        lblTypeIcons = new javax.swing.JLabel();
        panFooter = new javax.swing.JPanel();
        panSpacing1 = new javax.swing.JPanel();
        lblMail = new javax.swing.JLabel();
        lblUrl = new javax.swing.JLabel();
        panSpacing2 = new javax.swing.JPanel();
        panContent = new javax.swing.JPanel();
        lblAdresseDesc = new javax.swing.JLabel();
        lblTelefonDesc = new javax.swing.JLabel();
        lblFaxDesc = new javax.swing.JLabel();
        lblInfoDesc = new javax.swing.JLabel();
        lblAlternativnamenDesc = new javax.swing.JLabel();
        lblHaupttypDesc = new javax.swing.JLabel();
        lblSonstigeTypenDesc = new javax.swing.JLabel();
        lblAdresse = new javax.swing.JLabel();
        lblTel = new javax.swing.JLabel();
        lblFax = new javax.swing.JLabel();
        lblInfo = new javax.swing.JLabel();
        lblAlternativ = new javax.swing.JLabel();
        lblHaupttyp = new javax.swing.JLabel();
        lblSonst = new javax.swing.JLabel();

        panTitle.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 5, 5, 5));
        panTitle.setOpaque(false);
        panTitle.setLayout(new java.awt.GridBagLayout());

        lblTitle.setFont(new java.awt.Font("Tahoma", 1, 18));
        lblTitle.setForeground(new java.awt.Color(255, 255, 255));
        lblTitle.setText("TITLE");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(5, 10, 5, 5);
        panTitle.add(lblTitle, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.insets = new java.awt.Insets(5, 5, 5, 10);
        panTitle.add(lblTypeIcons, gridBagConstraints);

        panFooter.setBorder(javax.swing.BorderFactory.createEmptyBorder(10, 10, 15, 10));
        panFooter.setMinimumSize(new java.awt.Dimension(404, 0));
        panFooter.setOpaque(false);
        panFooter.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.CENTER, 20, 5));

        panSpacing1.setMaximumSize(new java.awt.Dimension(22, 22));
        panSpacing1.setMinimumSize(new java.awt.Dimension(22, 22));
        panSpacing1.setOpaque(false);
        panSpacing1.setPreferredSize(new java.awt.Dimension(22, 22));
        panFooter.add(panSpacing1);

        lblMail.setForeground(new java.awt.Color(51, 153, 255));
        lblMail.setIcon(new javax.swing.ImageIcon(getClass().getResource("/de/cismet/cids/custom/wunda_blau/res/mail_new.png"))); // NOI18N

        org.jdesktop.beansbinding.Binding binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.email}"), lblMail, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        lblMail.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblMailMouseClicked(evt);
            }
        });
        panFooter.add(lblMail);

        lblUrl.setForeground(new java.awt.Color(51, 153, 255));
        lblUrl.setIcon(new javax.swing.ImageIcon(getClass().getResource("/de/cismet/cids/custom/wunda_blau/res/html.png"))); // NOI18N

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.url}"), lblUrl, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        lblUrl.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lblUrlMouseClicked(evt);
            }
        });
        panFooter.add(lblUrl);

        panSpacing2.setMaximumSize(new java.awt.Dimension(22, 22));
        panSpacing2.setMinimumSize(new java.awt.Dimension(22, 22));
        panSpacing2.setOpaque(false);
        panSpacing2.setPreferredSize(new java.awt.Dimension(22, 22));
        panFooter.add(panSpacing2);

        setOpaque(false);
        setLayout(new java.awt.BorderLayout());

        panContent.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 15, 5, 20));
        panContent.setMinimumSize(new java.awt.Dimension(513, 100));
        panContent.setOpaque(false);
        panContent.setLayout(new java.awt.GridBagLayout());

        lblAdresseDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblAdresseDesc.setText("Adresse:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblAdresseDesc, gridBagConstraints);

        lblTelefonDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblTelefonDesc.setText("Telefon:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblTelefonDesc, gridBagConstraints);

        lblFaxDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblFaxDesc.setText("Fax.:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblFaxDesc, gridBagConstraints);

        lblInfoDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblInfoDesc.setText("Info:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblInfoDesc, gridBagConstraints);

        lblAlternativnamenDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblAlternativnamenDesc.setText("Alternativnamen:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblAlternativnamenDesc, gridBagConstraints);

        lblHaupttypDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblHaupttypDesc.setText("Haupttyp:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblHaupttypDesc, gridBagConstraints);

        lblSonstigeTypenDesc.setFont(new java.awt.Font("Tahoma", 1, 11));
        lblSonstigeTypenDesc.setText("sonstige Typen:");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 30);
        panContent.add(lblSonstigeTypenDesc, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.strasse}"), lblAdresse, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblAdresse, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.telefon}"), lblTel, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblTel, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.fax}"), lblFax, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblFax, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.info}"), lblInfo, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblInfo, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.alternativegeographicidentifier}"), lblAlternativ, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        binding.setConverter(new CollectionToStringConverter("alternativegeographicidentifier","<br>","<html>","</html>"));
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblAlternativ, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.mainlocationtype.identification}"), lblHaupttyp, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblHaupttyp, gridBagConstraints);

        binding = org.jdesktop.beansbinding.Bindings.createAutoBinding(org.jdesktop.beansbinding.AutoBinding.UpdateStrategy.READ, this, org.jdesktop.beansbinding.ELProperty.create("${cidsBean.locationtypes}"), lblSonst, org.jdesktop.beansbinding.BeanProperty.create("text"));
        binding.setSourceNullValue("-");
        binding.setSourceUnreadableValue("<Error>");
        binding.setConverter(new CollectionToStringConverter("identification","<br>","<html>", "</html>"));
        bindingGroup.addBinding(binding);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 5, 0);
        panContent.add(lblSonst, gridBagConstraints);

        add(panContent, java.awt.BorderLayout.CENTER);

        bindingGroup.bind();
    }// </editor-fold>//GEN-END:initComponents

    private void lblMailMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblMailMouseClicked
        final String email = lblMail.getText();
        if (email.length() > 3) {
            try {
                BrowserLauncher.openURL("mailto:" + email);
            } catch (Exception ex) {
                log.error("Fehler beim \u00D6ffnen der URL: \"mailto:" + email + "\"", ex);
            }
        }
    }//GEN-LAST:event_lblMailMouseClicked

    private void lblUrlMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lblUrlMouseClicked
        final String url = lblUrl.getText();
        if (url.length() > 3) {
            try {
                BrowserLauncher.openURL(url);
            } catch (Exception ex) {
                log.error("Fehler beim \u00D6ffnen der URL: " + url + "", ex);
            }
        }
    }//GEN-LAST:event_lblUrlMouseClicked

    private final void initLocationTypeImages() {
        final Collection<CidsBean> allTypes = (Collection<CidsBean>) cidsBean.getProperty("locationtypes");
//            log.fatal(allTypes);
        final List<ImageIcon> images = TypeSafeCollections.newArrayList(allTypes.size());
        if (allTypes.size() > 0) {
            for (final CidsBean type : allTypes) {
                try {
                    String filename = type.getProperty("identification") + "";
                    URL iconURL = getClass().getResource("/de/cismet/cids/custom/wunda_blau/res/64/" + filename + ".png");
                    if (iconURL != null) {
                        images.add(new javax.swing.ImageIcon(iconURL));
                    }
                } catch (Exception e) {
                    log.error("Fehler beim Laden eines LocationtypeImages, wird übersprungen!", e);
                }
            }
        }
        final ImageIcon[] imageArr = images.toArray(new ImageIcon[0]);
        if (imageArr.length > 0) {
            final Icon joined = Static2DTools.joinIcons(imageArr, 10, Static2DTools.HORIZONTAL, Static2DTools.CENTER);
            lblTypeIcons.setIcon(joined);
        } else {
            lblTypeIcons.setIcon(null);
        }

    }

    @Override
    public CidsBean getCidsBean() {
        return cidsBean;
    }

    @Override
    public void setCidsBean(CidsBean cidsBean) {
        if (cidsBean != null) {
            this.cidsBean = cidsBean;
            bindingGroup.unbind();
            bindingGroup.bind();
            initLocationTypeImages();
            if (lblMail.getText().length() < 3) {
                lblMail.setVisible(false);
            }
            if (lblUrl.getText().length() < 3) {
                lblUrl.setVisible(false);
            }
        }
    }

    @Override
    public String getTitle() {
        return title;
    }

    @Override
    public void setTitle(String title) {
        if (title == null) {
            title = "<Error>";
        }
        this.title = title;
        lblTitle.setText(this.title);
    }

    @Override
    public JComponent getTitleComponent() {
        return panTitle;
    }

    @Override
    public JComponent getFooterComponent() {
        return panFooter;
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel lblAdresse;
    private javax.swing.JLabel lblAdresseDesc;
    private javax.swing.JLabel lblAlternativ;
    private javax.swing.JLabel lblAlternativnamenDesc;
    private javax.swing.JLabel lblFax;
    private javax.swing.JLabel lblFaxDesc;
    private javax.swing.JLabel lblHaupttyp;
    private javax.swing.JLabel lblHaupttypDesc;
    private javax.swing.JLabel lblInfo;
    private javax.swing.JLabel lblInfoDesc;
    private javax.swing.JLabel lblMail;
    private javax.swing.JLabel lblSonst;
    private javax.swing.JLabel lblSonstigeTypenDesc;
    private javax.swing.JLabel lblTel;
    private javax.swing.JLabel lblTelefonDesc;
    private javax.swing.JLabel lblTitle;
    private javax.swing.JLabel lblTypeIcons;
    private javax.swing.JLabel lblUrl;
    private javax.swing.JPanel panContent;
    private javax.swing.JPanel panFooter;
    private javax.swing.JPanel panSpacing1;
    private javax.swing.JPanel panSpacing2;
    private javax.swing.JPanel panTitle;
    private org.jdesktop.beansbinding.BindingGroup bindingGroup;
    // End of variables declaration//GEN-END:variables

    @Override
    public Border getTitleBorder() {
        return BorderFactory.createEmptyBorder();
    }

    @Override
    public Border getFooterBorder() {
        return BorderFactory.createEmptyBorder();
    }

    @Override
    public Border getCenterrBorder() {
        return BorderFactory.createEmptyBorder();
    }
}
