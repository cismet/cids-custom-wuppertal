/***************************************************
*
* cismet GmbH, Saarbruecken, Germany
*
*              ... and it just works.
*
****************************************************/
package de.cismet.cids.custom.objectrenderer.wunda_blau;

import Sirius.navigator.ui.RequestsFullSizeComponent;

import org.openide.util.Exceptions;

import java.awt.Rectangle;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

import java.util.Arrays;
import java.util.Collection;

import javax.swing.DefaultListModel;

import de.cismet.cids.client.tools.DevelopmentTools;

import de.cismet.cids.dynamics.CidsBean;

import de.cismet.cids.tools.metaobjectrenderer.CidsBeanAggregationRenderer;

/**
 * DOCUMENT ME!
 *
 * @author   Gilles Baatz
 * @version  $Revision$, $Date$
 */
public class Sb_stadtbildserieAggregationRenderer extends javax.swing.JPanel implements RequestsFullSizeComponent,
    CidsBeanAggregationRenderer {

    //~ Static fields/initializers ---------------------------------------------

    private static final org.apache.log4j.Logger LOG = org.apache.log4j.Logger.getLogger(
            Sb_stadtbildserieGridRenderer.class);

    //~ Instance fields --------------------------------------------------------

    private Collection<CidsBean> cidsBeans = null;

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private com.guigarage.jgrid.JGrid grdStadtbildserien;
    // End of variables declaration//GEN-END:variables

    //~ Constructors -----------------------------------------------------------

    /**
     * Creates new form Sb_stadtbildserieAggregationRenderer.
     */
    public Sb_stadtbildserieAggregationRenderer() {
        initComponents();
        grdStadtbildserien.addMouseMotionListener(new MouseAdapter() {

                int lastIndex = -1;

                @Override
                public void mouseMoved(final MouseEvent e) {
                    if (lastIndex >= 0) {
                        final Object o = grdStadtbildserien.getModel().getElementAt(lastIndex);
                        if (o instanceof Sb_stadtbildserieGridObject) {
                            final Rectangle r = grdStadtbildserien.getCellBounds(lastIndex);
                            if ((r != null) && !r.contains(e.getPoint())) {
                                // remove the marker once
                                if (((Sb_stadtbildserieGridObject)o).isMarker()) {
                                    ((Sb_stadtbildserieGridObject)o).setMarker(false);
                                    grdStadtbildserien.repaint(r);
                                }
                            }
                        }
                    }

                    final int index = grdStadtbildserien.getCellAt(e.getPoint());
                    if (index >= 0) {
                        final Object o = grdStadtbildserien.getModel().getElementAt(index);
                        if (o instanceof Sb_stadtbildserieGridObject) {
                            final Rectangle r = grdStadtbildserien.getCellBounds(index);
                            if (r != null) {
                                ((Sb_stadtbildserieGridObject)o).setFraction(
                                    ((float)e.getPoint().x - (float)r.x)
                                            / (float)r.width);
                                ((Sb_stadtbildserieGridObject)o).setMarker(true);
                                lastIndex = index;
                                grdStadtbildserien.repaint(r);
                            }
                        }
                    }
                }
            });
    }

    //~ Methods ----------------------------------------------------------------

    /**
     * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this code. The
     * content of this method is always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        grdStadtbildserien = new com.guigarage.jgrid.JGrid();

        setLayout(new java.awt.BorderLayout());
        add(grdStadtbildserien, java.awt.BorderLayout.CENTER);
        final DefaultListModel<Sb_stadtbildserieGridObject> gridModel =
            new DefaultListModel<Sb_stadtbildserieGridObject>();
        grdStadtbildserien.setModel(gridModel);
        grdStadtbildserien.getCellRendererManager()
                .setDefaultRenderer(new de.cismet.cids.custom.objectrenderer.wunda_blau.Sb_stadtbildserieGridRenderer());
    } // </editor-fold>//GEN-END:initComponents

    @Override
    public Collection<CidsBean> getCidsBeans() {
        return cidsBeans;
    }

    @Override
    public void setCidsBeans(final Collection<CidsBean> beans) {
        this.cidsBeans = beans;
        final DefaultListModel model = (DefaultListModel)grdStadtbildserien.getModel();
        for (final CidsBean bean : beans) {
            final Sb_stadtbildserieGridObject gridObject = new Sb_stadtbildserieGridObject(model);
            gridObject.setCidsBean(bean);
            model.addElement(gridObject);
        }
    }

    @Override
    public void dispose() {
    }

    @Override
    public String getTitle() {
        return "Leuchtkasten";
    }

    @Override
    public void setTitle(final String title) {
    }

    /**
     * DOCUMENT ME!
     *
     * @param  args  DOCUMENT ME!
     */
    public static void main(final String[] args) {
        try {
            final CidsBean[] beans = DevelopmentTools.createCidsBeansFromRMIConnectionOnLocalhost(
                    "WUNDA_BLAU",
                    "Administratoren",
                    "admin",
                    "kif",
                    "sb_stadtbildserie",
                    " id = 5 or id = 6 or id = 285195 ",
                    10);

            DevelopmentTools.createAggregationRendererInFrameFromRMIConnectionOnLocalhost(Arrays.asList(beans),
                "Leuchtkasten",
                1024,
                800);
        } catch (Exception ex) {
            Exceptions.printStackTrace(ex);
        }
    }
}
